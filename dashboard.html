<!DOCTYPE html>
<html>
  <head> 
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Dashboard</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Choices.js-->
    <link rel="stylesheet" href="vendor/choices.js/public/assets/styles/choices.min.css">
    <!-- Google fonts - Muli-->
    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:300,400,700"> -->
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="img/favicon.ico">
    <script src="https://kit.fontawesome.com/74760b9276.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
  </head>
  <body style="font-family: Poppins;">
    <div class="d-flex align-items-stretch">
      <!-- Sidebar Navigation-->
      <nav id="sidebar">
        <!-- Sidebar Header-->
        <div class="sidebar-header d-flex align-items-center p-4"><img class="avatar shadow-0 img-fluid rounded-circle" src="img/avatar-6.jpg" alt="...">
          <div class="ms-3 title">
            <h1 class="h5 mb-1 nama-display"></h1>
            <p class="text-sm text-gray-700 mb-0 lh-1 nim-display"></p>
          </div>
        </div><span class="text-uppercase text-gray-600 text-xs mx-3 px-2 heading mb-2">Main</span>
        <ul class="list-unstyled">
              <li class="sidebar-item active"><a class="sidebar-link" href="index.html"> 
                <svg class="svg-icon svg-icon-sm svg-icon-heavy">
                  <use xlink:href="#real-estate-1"> </use>
                </svg><span>Home </span></a>
              </li>
        </ul>
        <span class="text-uppercase text-gray-600 text-xs mx-3 px-2 heading mb-2">Extras</span>
        <ul class="list-unstyled">
          <li class="sidebar-item"><a class="sidebar-link" href="login.html"> 
            <svg class="svg-icon svg-icon-sm svg-icon-heavy">
              <use xlink:href="#disable-1"> </use>
            </svg><span>Logout </span></a>
          </li>
        </ul>
      </nav>
      <div class="page-content">
            <!-- Page Header-->
            <div class="bg-dash-dark-2 py-4">
              <div class="container-fluid">
                <h2 class="h5 mb-0 d-inline">Dashboard</h2>
                <!-- <div class="float-end">
                  <button class="btn btn-outline-light btn-sm text-light"><i class="fa-solid fa-pen-to-square" id="passwordUpdateButton"></i> Ubah Password</button>
                </div> -->
              </div>
            </div>
            <section class="pt-0">
              <div class="container-fluid">
                <div class="row-gy-4">
                  <div class="col">
                    <div class="card mt-4">
                      <div class="card-header">
                        <h3 class="h4 mb-0">Biodata Mahasiswa</h3>
                      </div>
                      <div class="card-body pt-0">  
                        <form>
                          <div class="row">
                            <label class="col-sm-3 form-label">NIM</label>
                            <div class="col-sm-9">
                              <input id="nim" class="form-control text-dark" type="text" readonly>
                            </div>
                          </div>
                          <div class="my-4"></div>
                          <div class="row">
                            <label class="col-sm-3 form-label">Nama</label>
                            <div class="col-sm-9">
                              <input id="nama" class="form-control text-dark" type="text" readonly>
                            </div>
                          </div>
                          <div class="my-4"></div>
                          <div class="row">
                            <label class="col-sm-3 form-label">Jenis Kelamin</label>
                            <div class="col-sm-9">
                              <input id="jenisKelamin" class="form-control text-dark" type="text" readonly>
                            </div>
                          </div>
                          <div class="my-4"></div>
                          <div class="row">
                            <label class="col-sm-3 form-label">Program Studi</label>
                            <div class="col-sm-9">
                              <input id="prodi" class="form-control text-dark" type="text" readonly>
                            </div>
                          </div>
                          <div class="my-4"></div>
                          <div class="row">
                            <label class="col-sm-3 form-label">Alamat</label>
                            <div class="col-sm-9">
                              <input id="alamat" class="form-control text-dark" type="text" readonly>
                            </div>
                          </div>
                          <div class="my-4"></div>
                          <div class="row">
                            <label class="col-sm-3 form-label">Nomor telepon</label>
                            <div class="col-sm-9">
                              <input id="nomorTelepon" class="form-control text-dark" type="text" readonly>
                            </div>
                          </div>
                          <div class="my-4"></div>
                          <div class="row">
                            <div class="col-sm-9 ms-auto">
                              <button class="btn btn-primary" id="updateButton" type="button" data-bs-toggle="modal" data-bs-target="#myModal">Update</button>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                  <!-- Modal Update-->
                  <div class="modal fade text-start" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="myModalLabel">Update Biodata</h5>
                          <button class="btn-close btn-close-white" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <p>Lengkapi Biodata Anda.</p>
                          <form id="updateForm">
                            <div class="mb-3">
                              <label class="form-label" for="nimUpdate">NIM</label>
                              <input class="form-control text-dark" id="nimUpdate" type="text" aria-describedby="emailHelp" readonly>
                            </div>
                            <div class="mb-3">
                              <label class="form-label" for="namaUpdate">Nama</label>
                              <input class="form-control" id="namaUpdate" type="text" aria-describedby="emailHelp">
                            </div>
                            <div class="mb-3">
                              <label class="form-label" for="jenisKelaminUpdate">Jenis Kelamin</label>
                              <select class="form-select mb-3" id="jenisKelaminUpdate" name="jenisKelaminUpdate">
                                <option value="Laki-Laki">Laki-Laki</option>
                                <option value="Perempuan">Perempuan</option>
                              </select>
                            </div>
                            <div class="mb-3">
                              <label class="form-label" for="prodiUpdate">Program Studi</label>
                              <input class="form-control" id="prodiUpdate" type="text" aria-describedby="emailHelp">
                            </div>
                            <div class="mb-3">
                              <label class="form-label" for="alamatUpdate">Alamat</label>
                              <input class="form-control" id="alamatUpdate" type="text" aria-describedby="emailHelp">
                            </div>
                            <div class="mb-3">
                              <label class="form-label" for="nomorTeleponUpdate">Nomor Telepon</label>
                              <input class="form-control" id="nomorTeleponUpdate" type="text" aria-describedby="emailHelp">
                            </div>
                          </form>
                        </div>
                        <div class="modal-footer">
                          <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Tutup</button>
                          <button class="btn btn-primary" id="simpanButton" type="button">Simpan</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
                </div>
              </div>
            </section>

        <!-- Page Footer-->
        <footer class="position-absolute bottom-0 bg-dash-dark-2 text-white text-center py-3 w-100 text-xs" id="footer">
          <div class="container-fluid text-center">
            <!-- Please do not remove the backlink to us unless you support us at https://bootstrapious.com/donate. It is part of the license conditions. Thank you for understanding :)-->
            <p class="mb-0 text-dash-gray">2021 &copy; Your company. Design by <a href="https://bootstrapious.com">Bootstrapious</a>.</p>
          </div>
        </footer>
      </div>
    </div>
    <!-- JavaScript files-->
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="vendor/just-validate/js/just-validate.min.js"></script>
    <script src="vendor/chart.js/Chart.min.js"></script>
    <script src="vendor/choices.js/public/assets/scripts/choices.min.js"></script>
    <script src="js/charts-home.js"></script>
    <!-- Main File-->
    <script src="js/front.js"></script>
    <script>
      // ------------------------------------------------------- //
      //   Inject SVG Sprite - 
      //   see more here 
      //   https://css-tricks.com/ajaxing-svg-sprite/
      // ------------------------------------------------------ //
      function injectSvgSprite(path) {
      
          var ajax = new XMLHttpRequest();
          ajax.open("GET", path, true);
          ajax.send();
          ajax.onload = function(e) {
          var div = document.createElement("div");
          div.className = 'd-none';
          div.innerHTML = ajax.responseText;
          document.body.insertBefore(div, document.body.childNodes[0]);
          }
      }
      // this is set to BootstrapTemple website as you cannot 
      // inject local SVG sprite (using only 'icons/orion-svg-sprite.svg' path)
      // while using file:// protocol
      // pls don't forget to change to your domain :)
      injectSvgSprite('https://bootstraptemple.com/files/icons/orion-svg-sprite.svg'); 
    </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
    // Fungsi untuk mendapatkan biodata dari API
    function getBiodata(username) {
      fetch('https://sheet.best/api/sheets/7efe2fef-d9a7-454b-82b2-bd0c0853b1ae')
        .then(response => response.json())
        .then(data => {
          const biodata = data.find(user => user.NIM === username);
          if (biodata) {
            // Menampilkan biodata pada halaman
            document.querySelector('.nim-display').innerHTML = biodata.NIM;
            document.querySelector('.nama-display').innerHTML = biodata.Nama;
            document.getElementById('nim').value = biodata.NIM;
            document.getElementById('nama').value = biodata.Nama;
            document.getElementById('jenisKelamin').value = biodata["Jenis Kelamin"];
            document.getElementById('prodi').value = biodata.Prodi;
            document.getElementById('alamat').value = biodata.Alamat;
            document.getElementById('nomorTelepon').value = biodata.Telepon;
            // Simpan password di localStorage
            localStorage.setItem('password', biodata.Password);
          } else {
            console.error('Biodata tidak ditemukan');
            alert('Biodata tidak ditemukan');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Terjadi kesalahan saat memuat biodata.');
        });
    }

    // Panggil fungsi getBiodata setelah DOM dimuat
    const username = localStorage.getItem('username');
    if (username) {
      getBiodata(username);
    } else {
      console.error('Username tidak ditemukan di local storage');
    }

    // Tambahkan event listener pada tombol "Update" di bagian kartu biodata
    document.getElementById('updateButton').addEventListener('click', function () {
      const nim = document.getElementById('nim').value;
      const nama = document.getElementById('nama').value;
      const jenisKelamin = document.getElementById('jenisKelamin').value;
      const prodi = document.getElementById('prodi').value;
      const alamat = document.getElementById('alamat').value;
      const nomorTelepon = document.getElementById('nomorTelepon').value;

      // Set nilai input pada modal dengan nilai biodata yang ada
      document.getElementById('nimUpdate').value = nim;
      document.getElementById('namaUpdate').value = nama;
      document.getElementById('jenisKelaminUpdate').value = jenisKelamin;
      document.getElementById('prodiUpdate').value = prodi;
      document.getElementById('alamatUpdate').value = alamat;
      document.getElementById('nomorTeleponUpdate').value = nomorTelepon;

      // Tampilkan modal
      $('#myModal').modal('show');
    });

    // Script untuk memperbarui biodata
    function updateBiodata(nim, data) {
      fetch(`https://sheet.best/api/sheets/7efe2fef-d9a7-454b-82b2-bd0c0853b1ae/NIM/${nim}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
      })
      .then(response => {
        if (response.ok) {
          return response.json(); // Pastikan mengembalikan respons JSON
        } else {
          throw new Error('Terjadi kesalahan saat memperbarui data');
        }
      })
      .then(updatedData => {
        // Tutup modal setelah pembaruan berhasil
        $('#myModal').modal('hide');
        // Tampilkan pesan sukses
        Swal.fire(
            'Success!',
            'Data berhasil diperbarui',
            'success'
          );
        // Muat ulang data setelah pembaruan berhasil
        getBiodata(localStorage.getItem('username'));
      })
      .catch(error => {
        // Tampilkan pesan kesalahan jika terjadi kesalahan
        console.error('Error:', error);
        alert('Terjadi kesalahan saat memperbarui data.');
      });
    }

    // Event listener untuk tombol "Simpan" di modal
    document.getElementById('simpanButton').addEventListener('click', function () {
      const nim = document.getElementById('nimUpdate').value;
      const nama = document.getElementById('namaUpdate').value;
      const jenisKelamin = document.getElementById('jenisKelaminUpdate').value;
      const prodi = document.getElementById('prodiUpdate').value;
      const alamat = document.getElementById('alamatUpdate').value;
      const nomorTelepon = document.getElementById('nomorTeleponUpdate').value;

      // Dapatkan password dari localStorage
      const password = localStorage.getItem('password');

      // Data yang akan diperbarui
      const data = {
        NIM: nim,
        Nama: nama,
        "Jenis Kelamin": jenisKelamin,
        Prodi: prodi,
        Alamat: alamat,
        Telepon: nomorTelepon,
        Password: password // Tambahkan password yang tidak berubah
      };

      // Panggil fungsi untuk memperbarui biodata
      console.log('Mengirim data:', data); // Logging data sebelum dikirim
      updateBiodata(nim, data);
    });
  });

  </script>

    <!-- FontAwesome CSS - loading as last, so it doesn't block rendering-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
  </body>
</html>