<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Mahasiswa</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body style="font-family: Poppins; background-color: #DED6C9;">
    <div class="container">
        <div class="card shadow-lg mt-5 p-4 rounded-3" style="background-color: #F7F2ED;">
            <h4 class="text-center text-uppercase fw-bold">Data Mahasiswa</h4>
            <div class="d-flex mb-3">
                <button class="btn btn-success btn-sm me-auto" data-bs-toggle="modal" data-bs-target="#modalCreate">Tambah</button>
            </div>
            <table id="mahasiswa-table" class="table table-striped border shadow-lg" style="font-size: 15px;">
                <thead>
                    <tr>
                        <th>No</th>
                        <th>NIM</th>
                        <th>Nama</th>
                        <th>Jenis Kelamin</th>
                        <th>Program Studi</th>
                        <th>Alamat</th>
                        <th>Telepon</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="table-data">
                    <!-- Data Mahasiswa akan ditampilkan di sini -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal Create -->
    <div class="modal fade" id="modalCreate" tabindex="-1" aria-labelledby="modalCreateLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalCreateLabel">Tambah Mahasiswa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createForm">
                        <div class="mb-3">
                            <label for="createNIM" class="form-label">NIM</label>
                            <input type="text" class="form-control" id="createNIM" name="NIM" required>
                        </div>
                        <div class="mb-3">
                            <label for="createNama" class="form-label">Nama</label>
                            <input type="text" class="form-control" id="createNama" name="Nama" required>
                        </div>
                        <div class="mb-3">
                            <label for="createJenisKelamin" class="form-label">Jenis Kelamin</label>
                            <select class="form-control" id="createJenisKelamin" name="Jenis Kelamin" required>
                                <option value="Laki-laki">Laki-laki</option>
                                <option value="Perempuan">Perempuan</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="createProdi" class="form-label">Program Studi</label>
                            <input type="text" class="form-control" id="createProdi" name="Prodi" required>
                        </div>
                        <div class="mb-3">
                            <label for="createAlamat" class="form-label">Alamat</label>
                            <input type="text" class="form-control" id="createAlamat" name="Alamat" required>
                        </div>
                        <div class="mb-3">
                            <label for="createTelepon" class="form-label">Telepon</label>
                            <input type="text" class="form-control" id="createTelepon" name="Telepon" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Simpan</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Edit -->
    <div class="modal fade" id="modalEdit" tabindex="-1" aria-labelledby="modalEditLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalEditLabel">Edit Mahasiswa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="mb-3">
                            <label for="editNIM" class="form-label">NIM</label>
                            <input type="text" class="form-control" id="editNIM" name="NIM" required>
                        </div>
                        <div class="mb-3">
                            <label for="editNama" class="form-label">Nama</label>
                            <input type="text" class="form-control" id="editNama" name="Nama" required>
                        </div>
                        <div class="mb-3">
                            <label for="editJenisKelamin" class="form-label">Jenis Kelamin</label>
                            <select class="form-control" id="editJenisKelamin" name="Jenis Kelamin" required>
                                <option value="Laki-laki">Laki-laki</option>
                                <option value="Perempuan">Perempuan</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editProdi" class="form-label">Program Studi</label>
                            <input type="text" class="form-control" id="editProdi" name="Prodi" required>
                        </div>
                        <div class="mb-3">
                            <label for="editAlamat" class="form-label">Alamat</label>
                            <input type="text" class="form-control" id="editAlamat" name="Alamat" required>
                        </div>
                        <div class="mb-3">
                            <label for="editTelepon" class="form-label">Telepon</label>
                            <input type="text" class="form-control" id="editTelepon" name="Telepon" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Simpan</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            loadData();

            function loadData() {
                fetch('https://sheet.best/api/sheets/4ee74e4b-abc3-4858-a763-e6ad27ffdcbd')
                    .then(response => response.json())
                    .then(data => {
                        const tableBody = document.querySelector("#mahasiswa-table tbody");
                        tableBody.innerHTML = '';
                        data.forEach((mahasiswa, index) => {
                            const row = document.createElement("tr");
                            row.innerHTML = `
                            <td>${index + 1}</td>
                            <td>${mahasiswa.NIM}</td>
                            <td>${mahasiswa.Nama}</td>
                            <td>${mahasiswa["Jenis Kelamin"]}</td>
                            <td>${mahasiswa.Prodi}</td>
                            <td>${mahasiswa.Alamat}</td>
                            <td>${mahasiswa.Telepon}</td>
                            <td>
                                <button class="btn btn-sm btn-danger" onclick="deleteMahasiswa('${mahasiswa.NIM}')">Hapus</button>
                                <button class="btn btn-sm btn-warning text-light" data-bs-toggle="modal" data-bs-target="#modalEdit" data-nim="${mahasiswa.NIM}">Edit</button>
                            </td>
                            `;
                            tableBody.appendChild(row);
                        });

                        $('#mahasiswa-table').DataTable().destroy();
                        $('#mahasiswa-table').DataTable();
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        const tableBody = document.querySelector("#mahasiswa-table tbody");
                        const row = document.createElement("tr");
                        row.innerHTML = '<td colspan="8" class="text-center">Gagal memuat data! Silakan coba lagi nanti.</td>';
                        tableBody.appendChild(row);
                    });
            }

            // Submit form create
            document.getElementById("createForm").addEventListener("submit", function(event) {
                event.preventDefault();
                const formData = new FormData(event.target);
                const mahasiswa = {};
                formData.forEach((value, key) => {
                    mahasiswa[key] = value;
                });

                fetch('https://sheet.best/api/sheets/4ee74e4b-abc3-4858-a763-e6ad27ffdcbd', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(mahasiswa)
                })
                .then(response => response.json())
                .then(data => {
                    Swal.fire({
                        title: 'Berhasil!',
                        text: 'Data mahasiswa berhasil ditambahkan.',
                        icon: 'success',
                        confirmButtonText: 'OK'
                    }).then(() => {
                        $('#modalCreate').modal('hide');
                        loadData(); // Reload data
                        location.reload();
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });

            // Populate form edit
            $('#modalEdit').on('show.bs.modal', function (event) {
                var button = $(event.relatedTarget);
                var nim = button.data('nim');
                var modal = $(this);
                if (nim) {
                    fetch(`https://sheet.best/api/sheets/4ee74e4b-abc3-4858-a763-e6ad27ffdcbd/NIM/${nim}`)
                        .then(response => response.json())
                        .then(data => {
                            const mahasiswa = data[0];
                            modal.find('#editNIM').val(mahasiswa.NIM); // Set value for editNIM input
                            modal.find('#editNama').val(mahasiswa.Nama);
                            modal.find('#editJenisKelamin').val(mahasiswa["Jenis Kelamin"]);
                            modal.find('#editProdi').val(mahasiswa.Prodi);
                            modal.find('#editAlamat').val(mahasiswa.Alamat);
                            modal.find('#editTelepon').val(mahasiswa.Telepon);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                }
            });

            // Submit form edit
            document.getElementById("editForm").addEventListener("submit", function(event) {
                event.preventDefault();
                const formData = new FormData(event.target);
                const mahasiswa = {};
                formData.forEach((value, key) => {
                    mahasiswa[key] = value;
                });

                const nim = document.getElementById("editNIM").value; // Get value from editNIM input

                fetch(`https://sheet.best/api/sheets/4ee74e4b-abc3-4858-a763-e6ad27ffdcbd/NIM/${nim}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(mahasiswa)
                })
                .then(response => response.json())
                .then(data => {
                    Swal.fire({
                        title: 'Berhasil!',
                        text: 'Data mahasiswa berhasil diupdate.',
                        icon: 'success',
                        confirmButtonText: 'OK'
                    }).then(() => {
                        $('#modalEdit').modal('hide');
                        loadData(); // Reload data
                        location.reload();
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });

            window.deleteMahasiswa = function(nim) {
                Swal.fire({
                    title: 'Apakah anda yakin?',
                    text: "Data ini akan dihapus!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, hapus!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch(`https://sheet.best/api/sheets/4ee74e4b-abc3-4858-a763-e6ad27ffdcbd/NIM/${nim}`, {
                            method: 'DELETE'
                        })
                        .then(response => response.json())
                        .then(data => {
                            Swal.fire(
                                'Terhapus!',
                                'Data mahasiswa telah dihapus.',
                                'success'
                                ).then(() => {
                                    loadData();
                                    location.reload();
                                });
                            })
                            .catch(error => {
                                console.error('Error:', error);
                        });
                    }
            });
            }
        
        });
    </script>
</body>
</html>